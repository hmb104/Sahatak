# Sahatak Telemedicine Platform - Backend API v1.0.0

A comprehensive backend API for the Sahatak telemedicine platform, built with Flask and designed to support Arabic and English speaking users.

## Features

### **Core Functionality**
- **User Management**: Registration, authentication, and profile management
- **Bilingual Support**: Full Arabic and English language support
- **Role-Based Access**: Separate patient and doctor user types
- **Medical Profiles**: Detailed patient and doctor profile management
- **Appointment System**: Basic appointment booking and management
- **Health Assessments**: AI-powered health assessment framework

### **Production-Ready Infrastructure**
- **Standardized API Responses**: Consistent JSON response format across all endpoints
- **Comprehensive Error Handling**: Global error handlers with detailed logging
- **Health Monitoring**: Multiple health check endpoints with system metrics
- **Structured Logging**: JSON-formatted logs with request tracking
- **CORS Configuration**: Proper cross-origin resource sharing setup
- **Input Validation**: Robust validation for all user inputs
- **Security**: Password hashing, input sanitization, and SQL injection protection

## Backend Structure

```
backend/
â”œâ”€â”€ app.py                      # Main Flask application
â”œâ”€â”€ config.py                   # Configuration management
â”œâ”€â”€ models.py                   # Database models
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ .env.example               # Environment variables template
â”œâ”€â”€ logs/                      # Application logs (auto-created)
â”‚   â”œâ”€â”€ sahatak_app.log       # General application logs
â”‚   â”œâ”€â”€ sahatak_errors.log    # Error logs
â”‚   â””â”€â”€ sahatak_auth.log      # Authentication logs
â”œâ”€â”€ routes/                    # API route blueprints
â”‚   â”œâ”€â”€ auth.py               # Authentication endpoints
â”‚   â”œâ”€â”€ users.py              # User management endpoints
â”‚   â”œâ”€â”€ appointments.py       # Appointment management
â”‚   â”œâ”€â”€ medical.py            # Medical records
â”‚   â””â”€â”€ ai_assessment.py      # AI health assessments
â””â”€â”€ utils/                     # Utility modules
    â”œâ”€â”€ responses.py          # Standardized API responses
    â”œâ”€â”€ error_handlers.py     # Global error handling
    â”œâ”€â”€ logging_config.py     # Logging configuration
    â”œâ”€â”€ health_check.py       # Health monitoring
    â””â”€â”€ validators.py         # Input validation
```

## Setup Instructions

### Prerequisites
- Python 3.8+
- pip package manager

### 1. Install Dependencies
```bash
cd backend
pip install -r requirements.txt
```

### 2. Environment Configuration
```bash
# Copy environment template
cp .env.example .env

# Edit the .env file with your configuration
```

**Required Environment Variables:**
```env
# Flask Configuration
SECRET_KEY=your-secret-key-here
FLASK_ENV=development
DATABASE_URL=sqlite:///sahatak_dev.db

# Mail Configuration (Optional)
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password

# SMS Configuration (Optional)
SMS_USERNAME=sandbox
SMS_API_KEY=your-sms-api-key
SMS_SENDER_ID=SAHATAK
```

### 3. Run the Application
```bash
python app.py
```

The API will start at `http://localhost:5000`

## API Endpoints

### Authentication (`/api/auth`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/register` | Register new user (patient/doctor) |
| POST | `/login` | User login |
| POST | `/logout` | User logout |
| GET | `/me` | Get current user info |
| POST | `/change-password` | Change password |
| POST | `/update-language` | Update language preference |

### ðŸ‘¤ User Management (`/api/users`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/profile` | Get user profile |
| PUT | `/profile` | Update user profile |
| GET | `/doctors` | List verified doctors |
| GET | `/doctors/{id}` | Get doctor details |
| GET | `/specialties` | Get medical specialties |
| POST | `/deactivate` | Deactivate account |

### Appointments (`/api/appointments`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/` | Get user appointments |
| POST | `/` | Create new appointment |
| GET | `/{id}` | Get appointment details |

### Medical (`/api/medical`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/records` | Get medical records |
| GET | `/prescriptions` | Get prescriptions |

### AI Assessment (`/api/ai`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/assessment` | AI health assessment |

### Health Monitoring
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Basic health check |
| GET | `/health/detailed` | Comprehensive health status |
| GET | `/health/database` | Database health check |

## API Response Format

All API responses follow a standardized format:

### Success Response
```json
{
    "success": true,
    "message": "Operation successful",
    "timestamp": "2025-01-31T10:30:00Z",
    "status_code": 200,
    "data": {
        // Response data here
    },
    "meta": {
        // Optional metadata (pagination, etc.)
    }
}
```

### Error Response
```json
{
    "success": false,
    "message": "Error description",
    "timestamp": "2025-01-31T10:30:00Z",
    "status_code": 400,
    "error_code": "VALIDATION_ERROR",
    "field": "email",
    "details": {
        // Additional error details
    }
}
```

## Authentication

The API uses session-based authentication with Flask-Login. After successful login, users receive a session cookie that must be included in subsequent requests.

### Registration Examples

**Patient Registration:**
```json
POST /api/auth/register
{
    "email": "patient@example.com",
    "password": "securepass123",
    "first_name": "Ø£Ø­Ù…Ø¯",
    "last_name": "Ù…Ø­Ù…Ø¯",
    "user_type": "patient",
    "language_preference": "ar",
    "phone": "+249123456789",
    "age": 30,
    "gender": "male"
}
```

**Doctor Registration:**
```json
POST /api/auth/register
{
    "email": "doctor@example.com",
    "password": "securepass123",
    "first_name": "Dr. Sarah",
    "last_name": "Ahmed",
    "user_type": "doctor",
    "language_preference": "en",
    "phone": "+249987654321",
    "license_number": "MD12345",
    "specialty": "cardiology",
    "years_of_experience": 10
}
```

## Database Schema

### Users Table
- `id` - Primary key
- `email` - Unique email address
- `password_hash` - Hashed password
- `first_name`, `last_name` - User names
- `user_type` - 'patient' or 'doctor'
- `language_preference` - 'ar' or 'en'
- `is_active`, `is_verified` - Status flags
- Timestamps and audit fields

### Patients Table
- Links to Users table
- Medical information (age, gender, blood type)
- Medical history, allergies, medications
- Emergency contact information

### Doctors Table
- Links to Users table
- Professional information (license, specialty, experience)
- Verification status and ratings
- Consultation fees and availability

### Appointments Table
- Links to Patients and Doctors
- Appointment details (date, type, status)
- Medical notes and prescriptions
- Payment information

## Error Handling

The API includes comprehensive error handling:

- **Validation Errors**: Input validation with field-specific messages
- **Authentication Errors**: Login/permission issues
- **Database Errors**: Automatic rollback and logging
- **System Errors**: Graceful handling with error IDs for tracking

## Logging & Monitoring

### Log Files
- `sahatak_app.log` - General application logs
- `sahatak_errors.log` - Error-specific logs
- `sahatak_auth.log` - Authentication events

### Health Checks
- System resource monitoring (CPU, memory, disk)
- Database connectivity tests
- External service status
- Application metrics and uptime

## Development

### Running Tests
```bash
# Install test dependencies
pip install pytest pytest-cov

# Run tests
python -m pytest tests/
```

### Code Style
```bash
# Install development dependencies
pip install black flake8

# Format code
black .

# Check code style
flake8 .
```

## Production Deployment

### Environment Setup
1. Set `FLASK_ENV=production`
2. Use PostgreSQL for the database
3. Configure proper mail server
4. Set up SSL/TLS certificates
5. Use a production WSGI server (Gunicorn)

### Docker Deployment
```dockerfile
FROM python:3.9-slim
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]
```

## Support

For issues and questions:
- Check the logs in the `logs/` directory
- Use the health check endpoints to diagnose problems
- Review the comprehensive error messages in API responses

## Version History

- **v1.0.0** - Initial release with full user management, authentication, and health monitoring
